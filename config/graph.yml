stages:
  project:
    workspaces: {}
  asset:
    data:
      is_rigged:
        type: bool
        value: False
    workspaces:
      modeling:
        input: {}
        output:
          model: {promote: True}
          review: {}
        conditional:
          - conditions:
            - type: boolean
              source: stage[is_rigged]
            output:
              blendshape: {}
              animGeo: {promote: True}
      surfacing:
        input:
          model:
            connections:
            - type: internal
              workspace: modeling
              port_name: model
        output:
          texture:
            multi: True
            data:
              variation:
                type: list
                value:
                - type: str
                  value: passname
          material: {promote: True}
          model: {promote: True}
          review: {}
    conditional:
      - conditions:
        - type: boolean
          source: stage[is_rigged]
        workspaces:
          rig:
            input:
              animGeo:
                connections:
                - type: internal
                  workspace: modeling
                  port_name: animGeo
              blendshape:
                connections:
                - type: internal
                  workspace: modeling
                  port_name: blendshape
              model:
                connections:
                - type: internal
                  workspace: surfacing
                  port_name: model
                  data:
                    priority:
                      type: int
                      value: 1
                - type: internal
                  workspace: modeling
                  port_name: model
                  data:
                    priority:
                      type: int
                      value: 2
            output:
              rig: {promote: True}
  shot:
    # TODO: just define animated_instances and static_instances?
    data:
      animated_instances:
        type: list
        value: []
      static_instances:
        type: list
        value: []
    workspaces:
      layout:
        input:
          model:
            promote: True
            multi: True
            connections:
            - type: external
              port_name: model
              foreach:
                loop: stage[static_instances]
                item: item.asset
                group: item
          rig:
            promote: True
            multi: True
            connections:
            - type: external
              port_name: rig
              foreach:
                loop: stage[animated_instances]
                item: item.asset
                group: item
        output:
          cameraCache: {}
          cameraCurves: {}
          layout: {}
          animation:
              multi: texture
              foreach:
                loop: stage[animated_instances]
                group: item
      lighting:
        input:
          camera:
            connections:
            - type: internal
              workspace: layout
              port_name: cameraCache
          layout:
            connections:
            - type: internal
              workspace: layout
              port_name: layout
          material:
            multi: True
            connections:
            - type: external
              port_name: material
              foreach:
                loop: stage[animated_instances]
                item: item.asset
                group: item
        output:
          renders: {promote: True}
          review: {}
