stages:
  project:
    workspaces: {}
  asset:
    data:
      is_rigged:
        type: bool
        value: False
    workspaces:
      modeling:
        input: {}
        output:
          model: {promote: True}
          review: {}
        conditional:
          - conditions:
            - type: boolean
              source: stage[is_rigged]
            output:
              blendshape: {}
              animGeo: {promote: True}
      surfacing:
        input:
          model:
            connections:
            - type: internal
              workspace: modeling
              port_name: model
        output:
          texture:
            multi: True
            data:
              variation:
                type: list
                value:
                - type: str
                  value: passname
          material: {promote: True}
          model: {promote: True}
          review: {}
    conditional:
      - conditions:
        - type: boolean
          source: stage[is_rigged]
        workspaces:
          rig:
            input:
              animGeo:
                connections:
                - type: internal
                  workspace: modeling
                  port_name: animGeo
              blendshape:
                connections:
                - type: internal
                  workspace: modeling
                  port_name: blendshape
              model:
                connections:
                - type: internal
                  workspace: surfacing
                  port_name: model
                  data:
                    priority:
                      type: int
                      value: 1
                - type: internal
                  workspace: modeling
                  port_name: model
                  data:
                    priority:
                      type: int
                      value: 2
            output:
              rig: {promote: True}
  shot:
    data:
      assets:
        type: list
        value: []
    workspaces:
      layout:
        input:
          model:
            promote: True
            multi: True
            connections:
            - type: foreach
              workspace: surfacing
              port_name: model
              data:
                priority:
                  type: int
                  value: 1
              foreach:
                loop: stage[assets]
                conditions:
                - type: boolean
                  source: item[is_rigged]
                  invert: True
            - type: foreach
              workspace: modeling
              port_name: model
              data:
                priority:
                  type: int
                  value: 2
              foreach:
                loop: stage[assets]
                conditions:
                - type: boolean
                  source: item[is_rigged]
                  invert: True
          rig:
            promote: True
            multi: True
            connections:
            - type: foreach
              workspace: rig
              port_name: rig
              foreach:
                loop: stage[assets]
                conditions:
                - type: boolean
                  source: item[is_rigged]
        output:
          cameraCache: {}
          cameraCurves: {}
          layout: {}
          animation:
              multi: True
              data:
                variation:
                  type: list
                  value:
                    type: str
                    value: instance
      lighting:
        input:
          # Shot level publishes
          camera:
            connections:
            - type: internal
              workspace: layout
              port_name: cameraCache
          layout:
            connections:
            - type: internal
              workspace: layout
              port_name: layout
          # # Shot level instance publishes
          # animation:
          #   multi: True
          #   connections:
          #   # TODO: types of connection, eg, priority?
          #   - type: internal
          #     workspace: anim
          
          #     port_name: animation
          # Asset level publishes
          material:
            multi: True
            connections:
            - type: foreach
              workspace: surfacing
              port_name: material
              foreach:
                loop: stage[assets]
        output:
          renders: {promote: True}
          review: {}
